{% extends 'base.html' %}
{% block title %}Prontuário - Visualização{% endblock %}
{% block content %}

{% if not prontuario %}
  <div class="alert alert-warning">Prontuário não encontrado.</div>
{% else %}
  <div class="document-print" style="background:white; padding:18px; border-radius:6px; border:1px solid #e6e6e6;">
    <!-- Cabeçalho com logotipo e linhas de cabeçalho (Estado / Secretaria / Coordenação / Escola) -->
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px;">
      <div style="width:120px; text-align:center;">
        {# logotipo da escola (se existir) #}
        {% if prontuario and prontuario.aluno_id %}
          {# left box: tentamos mostrar logo selecionado no sistema se existir em static/img/logo.png #}
        {% endif %}
        <img src="{{ url_for('static', filename='img/logo-escola.png') }}" alt="Logo" style="max-width:100%; max-height:100px;">
      </div>
      <div style="flex:1; text-align:center;">
        <div style="font-weight:bold; text-transform:uppercase;">&lt;Estado / Secretaria / Coordenação / Escola - Cabeçalho&gt;</div>
        <div style="margin-top:6px; font-size:20px; font-weight:700;">PRONTUÁRIO</div>
        <div style="margin-top:2px; color:#666;">Emitido em: {{ prontuario.created_at or '-' }}</div>
      </div>
      <div style="width:140px; text-align:center;">
        {% if aluno %}
          {% if aluno.foto_filename or aluno.foto or aluno.photo %}
            <img src="{{ aluno.foto_filename or aluno.foto or (url_for('static', filename='uploads/alunos/' ~ aluno.photo) if aluno.photo else url_for('formularios_prontuario.api_aluno_foto', aluno_id=aluno.id)) }}" style="max-width:100%; max-height:120px; border:1px solid #ddd; padding:4px;">
          {% else %}
            <img src="{{ url_for('static', filename='img/placeholder-user.png') }}" style="max-width:100%; max-height:120px; border:1px solid #ddd; padding:4px;">
          {% endif %}
        {% else %}
          <img src="{{ url_for('static', filename='img/placeholder-user.png') }}" style="max-width:100%; max-height:120px; border:1px solid #ddd; padding:4px;">
        {% endif %}
      </div>
    </div>

    <hr style="margin:12px 0;">

    <table style="width:100%; margin-bottom:12px; border-collapse:collapse;">
      <tr>
        <td style="width:18%; vertical-align:top;"><strong>Aluno:</strong></td>
        <td style="width:32%; vertical-align:top;">{{ aluno.nome if aluno else '-' }}</td>
        <td style="width:12%; vertical-align:top;"><strong>Matrícula:</strong></td>
        <td style="width:38%; vertical-align:top;">{{ aluno.matricula if aluno else (prontuario.aluno_id or '-') }}</td>
      </tr>
      <tr>
        <td style="vertical-align:top;"><strong>Responsável:</strong></td>
        <td style="vertical-align:top;">{{ prontuario.responsavel or '-' }}</td>
        <td style="vertical-align:top;"><strong>Série/Turma:</strong></td>
        <td style="vertical-align:top;">{{ prontuario.serie or '-' }} {{ prontuario.turma or '' }}</td>
      </tr>
      <tr>
        <td style="vertical-align:top;"><strong>E-mail:</strong></td>
        <td style="vertical-align:top;">{{ prontuario.email or '-' }}</td>
        <td style="vertical-align:top;"><strong>Telefone:</strong></td>
        <td style="vertical-align:top;">{{ prontuario.telefone1 or prontuario.telefone2 or '-' }}</td>
      </tr>
      <tr>
        <td style="vertical-align:top;"><strong>Turno:</strong></td>
        <td style="vertical-align:top;">{{ prontuario.turno or '-' }}</td>
        <td></td>
        <td></td>
      </tr>
    </table>

    <h5 style="margin-top:6px;">Registros de Fatos Observados</h5>
    <div style="border:1px solid #000; padding:10px; min-height:120px; white-space:pre-wrap; background:#fff;">
      {{ prontuario.registros_fatos or '-' }}
    </div>

    <h5 style="margin-top:12px;">Circunstâncias atenuantes</h5>
    <div style="border:1px solid #ccc; padding:10px; min-height:60px; white-space:pre-wrap;">
      {{ prontuario.circunstancias_atenuantes or prontuario.circ_atenuantes or 'Não há' }}
    </div>

    <h5 style="margin-top:12px;">Circunstâncias agravantes</h5>
    <div style="border:1px solid #ccc; padding:10px; min-height:60px; white-space:pre-wrap;">
      {{ prontuario.circunstancias_agravantes or prontuario.circ_agravantes or 'Não há' }}
    </div>

    <div style="margin-top:18px; display:flex; gap:8px;">
      <a class="btn btn-secondary btn-sm" href="#" onclick="window.print(); return false;">Imprimir</a>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('formularios_prontuario.listar_prontuarios') }}">Voltar</a>
    </div>
  </div>
{% endif %}

{% endblock %}

