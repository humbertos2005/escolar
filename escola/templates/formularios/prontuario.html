{% extends 'base.html' %}
{% block title %}Prontuário{% endblock %}
{% block content %}

<div class="page-header d-flex align-items-center justify-content-between">
  <h2><i class="fas fa-file-medical"></i> Prontuário</h2>
  <!-- NOTE: removi os links no canto superior direito para não exibir "Novo" ou "Listar" aqui.
       O formulário deve aparecer somente quando o usuário clicar em "Novo Prontuário" na listagem. -->
</div>

<form id="form-prontuario" method="POST" action="{{ url_for('formularios_prontuario.salvar_prontuario') }}">
  {# Hidden aluno/prontuário se view fornecer (padrão vazio para novo) #}
  <input type="hidden" id="aluno_id" name="aluno_id" value="{{ prontuario.aluno_id if prontuario and prontuario.aluno_id else (aluno.id if aluno is defined and aluno and aluno.id else '') }}">
  <input type="hidden" id="prontuario_id" name="prontuario_id" value="{{ prontuario.id if prontuario and prontuario.id else '' }}">

  <div style="display:flex; gap:24px;">
    <div style="flex:1;">

      <div class="form-group">
        <label for="aluno_search">Aluno</label>
        <input type="text" id="aluno_search" name="aluno_search" class="form-control" autocomplete="off"
               value="{{ aluno.nome if aluno else (prontuario.aluno_nome if prontuario and prontuario.aluno_nome else '') }}"
               placeholder="Digite matrícula ou nome para buscar...">
      </div>

      <div class="form-group">
        <label for="responsavel">Responsável</label>
        <input type="text" id="responsavel" name="responsavel" class="form-control"
               value="{{ prontuario.responsavel if prontuario and prontuario.responsavel else '' }}">
      </div>

      <div class="form-group">
        <label for="serie">Série</label>
        <input type="text" id="serie" name="serie" class="form-control"
               value="{{ prontuario.serie if prontuario and prontuario.serie else '' }}">
      </div>

      <div class="form-group">
        <label for="turma">Turma</label>
        <input type="text" id="turma" name="turma" class="form-control"
               value="{{ prontuario.turma if prontuario and prontuario.turma else '' }}">
      </div>

      <div class="form-group">
        <label for="email">E-mail</label>
        <input type="email" id="email" name="email" class="form-control"
               value="{{ prontuario.email if prontuario and prontuario.email else '' }}">
      </div>

      <div class="form-group">
        <label for="telefone1">Telefone</label>
        <input type="text" id="telefone1" name="telefone1" class="form-control"
               value="{{ prontuario.telefone1 if prontuario and prontuario.telefone1 else (prontuario.telefone2 if prontuario and prontuario.telefone2 else '') }}">
      </div>

    </div>

    <div style="flex:1;">
      <div class="form-group">
        <label for="registros_fatos">Registros de Fatos Observados</label>
        <textarea id="registros_fatos" name="registros_fatos" class="form-control" rows="10" placeholder="Registros...">{{ prontuario.registros_fatos if prontuario and prontuario.registros_fatos else '' }}</textarea>
      </div>

      <div class="form-group">
        <label for="circunstancias_atenuantes">Circunstâncias atenuantes</label>
        <textarea id="circunstancias_atenuantes" name="circunstancias_atenuantes" class="form-control" rows="3" placeholder="Circunstâncias atenuantes...">{{ prontuario.circunstancias_atenuantes if prontuario and prontuario.circunstancias_atenuantes else (prontuario.circ_atenuantes if prontuario and prontuario.circ_atenuantes else '') }}</textarea>
      </div>

      <div class="form-group">
        <label for="circunstancias_agravantes">Circunstâncias agravantes</label>
        <textarea id="circunstancias_agravantes" name="circunstancias_agravantes" class="form-control" rows="3" placeholder="Circunstâncias agravantes...">{{ prontuario.circunstancias_agravantes if prontuario and prontuario.circunstancias_agravantes else (prontuario.circ_agravantes if prontuario and prontuario.circ_agravantes else '') }}</textarea>
      </div>

    </div>
  </div>

  <div style="margin-top:16px; display:flex; gap:8px;">
    <button type="submit" class="btn btn-primary">Salvar</button>
    <a href="{{ url_for('formularios_prontuario.listar_prontuarios') }}" class="btn btn-secondary">Cancelar</a>
  </div>
</form>

{% endblock %}

