<hr>
<h4><i class="fas fa-list"></i> Trata-se de um RFO de?</h4>
<div class="detail-item">
    {# Normaliza tipo_val a partir de dict ou atributos #}
    {% set tipo_val = '' %}
    {% if ocorrencia is mapping and ocorrencia.get is defined %}
        {% set tipo_val = ocorrencia.get('tratamento_tipo') or ocorrencia.get('tipo_rfo') or ocorrencia.get('tipo_ocorrencia_nome') or '' %}
    {% elif ocorrencia is defined %}
        {% if ocorrencia.tratamento_tipo is defined and ocorrencia.tratamento_tipo %}
            {% set tipo_val = ocorrencia.tratamento_tipo %}
        {% elif ocorrencia.tipo_rfo is defined and ocorrencia.tipo_rfo %}
            {% set tipo_val = ocorrencia.tipo_rfo %}
        {% elif ocorrencia.tipo_ocorrencia_nome is defined and ocorrencia.tipo_ocorrencia_nome %}
            {% set tipo_val = ocorrencia.tipo_ocorrencia_nome %}
        {% endif %}
    {% endif %}
    {% set tipo_val = (tipo_val|string).lower().strip() %}

    {% if tipo_val == 'elogio' %}
        <div><strong>Trata-se de um RFO de:</strong> Elogio</div>

        {# mostrar subtipo/tipo de elogio se houver #}
        {% set subtipo_elogio = '' %}
        {% set tipo_elogio = '' %}
        {% if ocorrencia is mapping and ocorrencia.get is defined %}
            {% set subtipo_elogio = ocorrencia.get('subtipo_elogio') or '' %}
            {% set tipo_elogio = ocorrencia.get('tipo_elogio') or '' %}
        {% else %}
            {% if ocorrencia is defined %}
                {% if ocorrencia.subtipo_elogio is defined %}{% set subtipo_elogio = ocorrencia.subtipo_elogio %}{% endif %}
                {% if ocorrencia.tipo_elogio is defined %}{% set tipo_elogio = ocorrencia.tipo_elogio %}{% endif %}
            {% endif %}
        {% endif %}
        {% if subtipo_elogio %}
            <div><strong>Tipo de Elogio:</strong> {{ subtipo_elogio }}</div>
        {% elif tipo_elogio %}
            <div><strong>Tipo de Elogio:</strong> {{ tipo_elogio }}</div>
        {% endif %}

    {% else %}
        <div><strong>Trata-se de um RFO de:</strong> Falta Disciplinar</div>

        {# localizar valor adv em fontes possíveis, de forma explícita #}
        {% set adv_raw = None %}
        {% if ocorrencia is mapping and ocorrencia.get is defined %}
            {% set a = ocorrencia.get('advertencia_oral') %}
            {% set b = ocorrencia.get('observador_advertencia_oral') %}
            {% if a is not none and a != '' %}
                {% set adv_raw = a %}
            {% elif b is not none and b != '' %}
                {% set adv_raw = b %}
            {% endif %}
        {% endif %}

        {% if adv_raw is none and ocorrencia is defined %}
            {% if ocorrencia.advertencia_oral is defined and ocorrencia.advertencia_oral != '' %}
                {% set adv_raw = ocorrencia.advertencia_oral %}
            {% elif ocorrencia.observador_advertencia_oral is defined and ocorrencia.observador_advertencia_oral != '' %}
                {% set adv_raw = ocorrencia.observador_advertencia_oral %}
            {% endif %}
        {% endif %}

        {# exibir somente se houver valor válido #}
        {% if adv_raw is not none and adv_raw != '' %}
            {% set adv_s = (adv_raw|string).strip().lower() %}
            <div>
                <strong>Observador considerou RFO como Advertência Oral?</strong>
                <span class="badge bg-info text-dark">
                    {% if adv_s == 'sim' or adv_s == 's' or adv_s == '1' %}
                        Sim
                    {% elif adv_s == 'nao' or adv_s == 'não' or adv_s == 'n' or adv_s == '0' %}
                        Não
                    {% else %}
                        {{ adv_raw }}
                    {% endif %}
                </span>
            </div>
        {% endif %}

    {% endif %}

    {# DEBUG temporário (invisível) #}
    <!-- DEBUG: tipo_val={{ tipo_val }} | adv_raw={{ adv_raw }} -->
</div>
